[(#REM)

  Squelette
  (c) 2009 xxx
  Distribue sous licence GPL

]
<?php

$notes = charger_fonction('notes', 'inc');
include_spip('tw_texte');
include_spip('inc/diff');
include_spip('inc/revisions');

$s = spip_query('SELECT * FROM spip_articles');

$erreurs = 10;
while ($t = sql_fetch($s)) {
	$notes('','reset_all');
	$tw = tw_propre($t['texte']);
	$notes('','reset_all');
	$pr = propre($t['texte']);

	if ($tw === $pr)
		echo "<li>article $t[id_article] OK</li>\n";
	else {
		echo "<li>article $t[id_article] <b>NOK</b>";
		echo " <a href='#' onclick=\"jQuery(this).siblings('div').toggle();return false;\">Voir</a>";
		$diff = new Diff(new DiffTexte);
		$n = preparer_diff(str_replace('<','&#60;',$tw));
		$o = preparer_diff(str_replace('<','&#60;',$pr));
		echo "<div style='display:none;'>".afficher_diff($diff->comparer($n,$o))."</div>";

		echo "</li>\n";
		if (!$erreurs--) break;
	}
}

?>